# GitHub Actions Deployment Setup for WordPress Theme

This guide explains how to set up automated deployment for your WordPress theme using GitHub Actions.

**Fully Manual Workflow**: This configuration requires manual triggers for both builds and deployments - nothing happens automatically.

## 🔧 GitLab CI Configuration

The `.gitlab-ci.yml` file includes:

- **Manual Build**: Compiles Vite assets (SCSS, JS) when manually triggered
- **Manual Deploy**: Manual deployment to production server
- **Manual Rollback**: Manual rollback functionality

## 📋 Prerequisites

1. GitLab repository with CI/CD enabled
2. SSH access to your web server
3. SSH private key for authentication

## ⚙️ Setup Instructions

### 1. Configure GitLab CI Variables

Go to your GitLab project: **Settings > CI/CD > Variables**

Add the following variable:

| Variable Name     | Value                        | Type     | Masked | Protected |
| ----------------- | ---------------------------- | -------- | ------ | --------- |
| `SSH_PRIVATE_KEY` | Your SSH private key content | Variable | ✅ Yes | ✅ Yes    |

### 2. Server Configuration

The CI is configured to deploy to:

- **Host**: `wet19.nazwa.pl`
- **User**: `wet19`
- **Path**: `domains/fajnestarocie.pl/public_html/wp-content/themes/fajnestarocie`

### 3. Branch Strategy

- **`master`/`main`**: Manual build and deployment available
- **Other branches**: No CI/CD actions (ignored)

## 🚀 Deployment Process

### Manual Build

1. Push changes to `master` or `main` branch
2. Go to GitLab: **CI/CD > Pipelines**
3. Click "Play" button on the **build** job
4. The build will:
   - Install npm dependencies
   - Run `npm run build` (Vite compilation)
   - Create build artifacts

### Manual Production Deployment

1. After successful build, click "Play" button on the **deploy** job
2. Monitor deployment progress

## 📁 Files Excluded from Deployment

The following files/directories are automatically excluded:

- `node_modules/`
- `.git/`
- `package.json`, `package-lock.json`
- `temp/`
- `.gitignore`, `*.md`
- `.env*`, `.vscode/`, `.idea/`
- `*.log`, `.DS_Store`

## 📁 Files Included in Deployment

- All PHP theme files
- `src/` (source files)
- `dist/` (compiled assets)
- `public/` (static assets)
- `style.css`
- `screenshot.png`
- `languages/`
- `woocommerce/`
- `template-parts/`
- `page-templates/`
- `inc/`
- Configuration files: `vite.config.js`, `postcss.config.js`, `tailwind.config.js`

## 🔄 Rollback Process

If you need to rollback a deployment:

1. Go to GitLab: **CI/CD > Pipelines**
2. Find the rollback job
3. Click "Play" button
4. The system will restore the previous version

## 🐛 Troubleshooting

### SSH Connection Issues

- Verify SSH key is correctly added to GitLab variables
- Check server SSH access
- Ensure key has proper permissions on server

### Build Failures

- Check `package.json` dependencies
- Verify Vite configuration
- Review build logs in GitLab CI

### Deployment Issues

- Verify server paths are correct
- Check file permissions on server
- Ensure sufficient disk space

## 📝 Customization

### Change Deployment Path

Edit the `REMOTE_THEME_PATH` variable in `.gitlab-ci.yml`:

```yaml
variables:
  REMOTE_THEME_PATH: 'your/custom/path/wp-content/themes/your-theme'
```

### Add Additional Excludes

Add more exclude patterns in the rsync command:

```yaml
--exclude='your-file-pattern' \
```

### Modify Build Process

Change the build commands in the build stage:

```yaml
script:
  - npm ci
  - npm run your-custom-build-command
```

## 🔒 Security Notes

- SSH private key is masked and protected in GitLab
- Only `master`/`main` branches have CI/CD jobs available
- **Fully manual workflow** prevents any accidental builds or releases
- All sensitive data should be in GitLab CI variables
- No `--delete` flag used for safer deployments
